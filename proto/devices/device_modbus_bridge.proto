syntax = "proto3";

package ringbahn.v1;

import "devices/device_common.proto";

// Top-level Modbus Bridge device command message
message ModbusBridgeDeviceCommand {
  oneof command {
    // Common commands
    SystemInfoRequest system_info = 1; // Response: SystemInfoResponse
    PingCommand ping = 2; // Response: CommandResult
    ResetCommand reset = 3; // Response: CommandResult
    
    // Modbus-specific commands
    ModbusReadCoilsRequest read_coils = 10; // Response: ModbusReadCoilsResponse
    ModbusReadDiscreteInputsRequest read_discrete_inputs = 11; // Response: ModbusReadDiscreteInputsResponse
    ModbusReadHoldingRegistersRequest read_holding_registers = 12; // Response: ModbusReadHoldingRegistersResponse
    ModbusReadInputRegistersRequest read_input_registers = 13; // Response: ModbusReadInputRegistersResponse
    ModbusWriteSingleCoilRequest write_single_coil = 14; // Response: CommandResult
    ModbusWriteSingleRegisterRequest write_single_register = 15; // Response: CommandResult
    ModbusWriteMultipleCoilsRequest write_multiple_coils = 16; // Response: CommandResult
    ModbusWriteMultipleRegistersRequest write_multiple_registers = 17; // Response: CommandResult
  }
}

// ===== Modbus Read Commands =====

// Response: ModbusReadCoilsResponse
message ModbusReadCoilsRequest {
  uint32 slave_address = 1; // Modbus slave address (1-247);
  uint32 starting_address = 2; // Starting coil address;
  uint32 quantity = 3; // Number of coils to read (1-32);
}

message ModbusReadCoilsResponse {
  repeated bool values = 1; // Coil values (max 32);
}

// Response: ModbusReadDiscreteInputsResponse
message ModbusReadDiscreteInputsRequest {
  uint32 slave_address = 1; // Modbus slave address (1-247);
  uint32 starting_address = 2; // Starting discrete input address;
  uint32 quantity = 3; // Number of discrete inputs to read (1-32);
}

message ModbusReadDiscreteInputsResponse {
  repeated bool values = 1; // Discrete input values (max 32);
}

// Response: ModbusReadHoldingRegistersResponse
message ModbusReadHoldingRegistersRequest {
  uint32 slave_address = 1; // Modbus slave address (1-247);
  uint32 starting_address = 2; // Starting register address;
  uint32 quantity = 3; // Number of registers to read (1-32);
}

message ModbusReadHoldingRegistersResponse {
  repeated uint32 values = 1; // Register values (max 32);
}

// Response: ModbusReadInputRegistersResponse
message ModbusReadInputRegistersRequest {
  uint32 slave_address = 1; // Modbus slave address (1-247);
  uint32 starting_address = 2; // Starting register address;
  uint32 quantity = 3; // Number of registers to read (1-32);
}

message ModbusReadInputRegistersResponse {
  repeated uint32 values = 1; // Register values (max 32);
}

// ===== Modbus Write Commands =====

// Response: CommandResult
message ModbusWriteSingleCoilRequest {
  uint32 slave_address = 1; // Modbus slave address (1-247);
  uint32 coil_address = 2; // Coil address;
  bool value = 3; // Coil value;
}

// Response: CommandResult
message ModbusWriteSingleRegisterRequest {
  uint32 slave_address = 1; // Modbus slave address (1-247);
  uint32 register_address = 2; // Register address;
  uint32 value = 3; // Register value;
}

// Response: CommandResult
message ModbusWriteMultipleCoilsRequest {
  uint32 slave_address = 1; // Modbus slave address (1-247);
  uint32 starting_address = 2; // Starting coil address;
  repeated bool values = 3; // Coil values (max 32);
}

// Response: CommandResult
message ModbusWriteMultipleRegistersRequest {
  uint32 slave_address = 1; // Modbus slave address (1-247);
  uint32 starting_address = 2; // Starting register address;
  repeated uint32 values = 3; // Register values (max 32);
}
