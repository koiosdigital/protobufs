syntax = "proto3";

import "kd/v1/common.proto";

package kd.v1;

message MatrxMessage {
    oneof message {
        ScheduleRequest schedule_request = 1; //to server - returns CommandResult
        SpriteRenderRequest sprite_render_request = 2; //to server - returns CommandResult
        ModifyScheduleItem modify_schedule_item = 3; //to server - returns CommandResult
        DeviceConfigRequest device_config_request = 4; //either direction - request current device config
        CurrentlyDisplayingUpdate currently_displaying_update = 5; //to server - device reports what is currently displaying
        DeviceInfo device_info = 10; //to server - device info payload - returns CommandResult

        MatrxSchedule schedule = 11; //from server
        MatrxSpriteData sprite_data = 12; //from server
        DeviceConfig device_config = 13; //either direction - device config payload

        //common
        CommandResult command_result = 100; //from server - generic command response
        UploadCoreDump upload_core_dump = 101; //to server - returns CommandResult

        // Sent from server when a connection is established.
        JoinResponse join_response = 104; //from server

        // Sent to server to claim the device to a user account.
        ClaimDevice claim_device = 105; //to server
    }
}

message DeviceInfo {
    uint32 width = 1;
    uint32 height = 2;
    bool has_light_sensor = 3;
}

//MARK: Device Config
message DeviceConfigRequest {

}

message DeviceConfig {
    bool screen_enabled = 1;
    uint32 screen_brightness = 2;
    bool auto_brightness_enabled = 3;
    uint32 screen_off_lux = 4;
}

//MARK: Schedule
message ScheduleRequest {

}

message ScheduleItem {
    bytes uuid = 1;
    uint32 display_time = 2;
    bool pinned = 3;
    bool skipped = 4;
}

message MatrxSchedule {
    repeated ScheduleItem schedule_items = 1;
}

//MARK: Render
message SpriteRenderRequest {
    bytes sprite_uuid = 1;
    uint32 device_width = 2;
    uint32 device_height = 3;
}

message MatrxSpriteData {
    bytes sprite_uuid = 1;
    bytes sprite_data = 2;
    uint32 ttl_epoch = 3;
    bool error = 4;
}

message ModifyScheduleItem {
    bytes uuid = 1;
    bool  pinned = 2;
    bool  skipped = 3;
}

//MARK: Currently Displaying
message CurrentlyDisplayingUpdate {
    bytes installation_uuid = 1; // UUID of the installation currently being displayed
}